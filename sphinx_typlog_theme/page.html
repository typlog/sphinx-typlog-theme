{% extends "layout.html" %}

{%- macro strip_meta(html, name) %}
{%- set text = html|
  replace('name="' + name + '"', '')|
  replace('content=', '')|
  replace('<meta', '')|
  replace('/>', '')|
  replace('"', '')|trim
-%}
{{ text }}
{%- endmacro %}

{%- macro og_meta() %}
{%- set has_desc = false %}
{%- for html in metatags.split('\n') %}
  {%- if 'name="description"' in html %}
    {%- set has_desc = true %}
    {%- set text = strip_meta(html, 'description')|trim %}
    <meta property="og:description" content="{{ text }}">
  {%- elif 'name="image"' in html %}
    {%- set src = strip_meta(html, 'image')|trim %}
    <meta property="og:image" content="{{ src }}">
  {%- endif %}
{%- endfor %}
{%- if not has_desc and theme_description %}
<meta property="og:description" content="{{ theme_description }}">
{%- endif %}
{%- endmacro %}

{% block extrahead %}
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="{{ project }}">
  <meta property="og:title" content="{{ title|striptags|e }}">
  {%- if pagename == 'index' and theme_description %}
    <meta property="og:description" content="{{ theme_description }}">
  {%- else %}
    {{- og_meta() }}
  {%- endif %}
  {%- if theme_og_image and 'name="image"' not in metatags %}
    <meta property="og:image" content="{{ theme_og_image }}">
  {%- endif %}
  <meta name="twitter:card" content="summary">
  {%- if theme_twitter %}
  <meta name="twitter:creator" content="@{{ theme_twitter }}">
  {%- endif -%}
{% endblock %}

{% block body %}
  {{ body }}
{% endblock %}
